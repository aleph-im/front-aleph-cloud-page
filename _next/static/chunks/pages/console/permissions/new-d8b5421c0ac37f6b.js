(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5162],{15877:function(e,r,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/console/permissions/new",function(){return o(7422)}])},19584:function(e,r,o){"use strict";var a=o(85893),d=o(57833),l=o(73899);r.Z=e=>{let{handleBack:r}=e;return(0,a.jsx)(l.zx,{kind:"functional",variant:"textOnly",onClick:r,children:(0,a.jsxs)(c,{className:"tp-info text-base2",children:[(0,a.jsx)(l.JO,{name:"arrow-left"})," Back"]})})};var c=(0,d.ZP)("p").withConfig({displayName:"cmp___StyledP",componentId:"sc-1jijf1x-0"})({display:"flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",textAlign:"center"})},93788:function(e,r,o){"use strict";o.d(r,{Z:function(){return BackButtonSection_cmp}});var a=o(85893),d=o(57833),l=o(19584),c=o(99983),BackButtonSection_cmp=e=>{let{handleBack:r}=e;return(0,a.jsx)(m,{children:(0,a.jsx)(c.F,{children:(0,a.jsx)(l.Z,{handleBack:r})})})},m=(0,d.ZP)("section").withConfig({displayName:"cmp___StyledSection",componentId:"sc-o42jnx-0"})({paddingTop:"0px !important",paddingBottom:"0px !important",paddingLeft:"0px",paddingRight:"0px","@media (min-width: 48rem)":{paddingTop:"2.5rem !important"}})},72882:function(e,r,o){"use strict";o.d(r,{ZP:function(){return f}});var a=o(85893),d=o(67294),l=o(73899),c=o(43251),m=o(57833);let p=(0,m.ZP)(l.JO).attrs(e=>{let{buttonSize:r}=e;return{size:(()=>{switch(r){case"xs":return"xs";case"sm":return"sm";case"lg":return"md-lg";case"xl":return"lg";default:return"md"}})()}}).withConfig({displayName:"styles__InfoIcon",componentId:"sc-15zds0b-0"})(["opacity:0.8;"]),u=(0,d.forwardRef)((e,r)=>{let{tooltipContent:o,tooltipPosition:m,children:u,disabled:f,size:h,...g}=e,[x,y]=(0,d.useState)(!1);(0,d.useEffect)(()=>{y(!0)},[]);let v=(0,d.useRef)(null),j=r||v;return(0,a.jsxs)("div",{className:"inline-flex relative",children:[(0,a.jsx)(l.zx,{ref:j,disabled:f,size:h,...g,children:(0,a.jsxs)(a.Fragment,{children:[u,f&&o&&(0,a.jsx)(p,{name:"info-circle",buttonSize:h})]})}),x&&f&&o&&(0,a.jsx)(c.Z,{my:(null==m?void 0:m.my)||"bottom-center",at:(null==m?void 0:m.at)||"top-center",targetRef:j,content:o})]})});u.displayName="ButtonWithInfoTooltip";var f=u},49531:function(e,r,o){"use strict";o.d(r,{N:function(){return c}});var a=o(85893),d=o(67294),l=o(73899);let SectionTitle=e=>{let{forwardedAs:r,...o}=e;return(0,a.jsx)(l.NP,{as:"h2",color:"main0",numberColor:"main0",...o})};SectionTitle.displayName="SectionTitle";var c=(0,d.memo)(SectionTitle)},43251:function(e,r,o){"use strict";o.d(r,{Z:function(){return m}});var a=o(85893),d=o(57833),l=o(67294),c=o(73899);let ResponsiveTooltip=e=>{let{forwardedAs:r,as:o,...d}=e,l=(0,c._K)("md");return(0,a.jsx)(p,{...d,$_css:l?{position:"fixed !important",left:"0px !important",top:"0px !important",zIndex:"20 !important",margin:"1.5rem",height:"calc(100% - 3rem) !important",width:"calc(100% - 3rem) !important",maxWidth:"100% !important",transform:"none !important"}:""})};ResponsiveTooltip.displayName="ResponsiveTooltip";var m=(0,l.memo)(ResponsiveTooltip),p=(0,d.ZP)(c.u).withConfig({displayName:"cmp___StyledTooltip",componentId:"sc-vdmo8c-0"})(["",""],e=>e.$_css)},7422:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return NewInstancePage}});var a=o(85893),d=o(57833),l=o(67294),c=o(9008),m=o.n(c),p=o(73899),u=o(72882),f=o(99983),h=o(11163),g=o(24959),x=o(87536),y=o(86780),v=o(72648),j=o(50586),w=o(75968),_=o(43459),b=o(60566),N=o(56312),C=o(27107),P=o(9911),T=o(75650),S=o(49531),Z=o(93788),k=o(85661),R=o(35464),B=o(16031);let I=l.memo(e=>{let{disabled:r,title:o="Save permissions",tooltipContent:d,isFooter:c,handleSubmit:m}=e,p=(0,l.useRef)(null);return(0,a.jsx)(u.ZP,{ref:p,type:"submit",color:"main0",kind:"default",size:"lg",variant:"primary",disabled:r,tooltipContent:d,tooltipPosition:{my:c?"bottom-right":"bottom-center",at:c?"top-right":"top-center"},onClick:m,children:o})});function NewInstancePage(e){let{mainRef:r}=e,{createPermissionDisabled:o,createPermissionDisabledMessage:d,createPermissionButtonTitle:c,control:u,errors:L,handleSubmit:U,handleBack:W,addressCtrl:q,aliasCtrl:D,isDirty:J}=function(){let{account:e}=(0,v.R)({triggerOnMount:!1}),r=(0,h.useRouter)(),o=(0,l.useCallback)(()=>{r.push(".")},[r]),d=(0,w.o)(),{refetch:c}=(0,C.M)({triggerOnMount:!1}),{noti:m,next:p,stop:u}=(0,y.A)({}),f=(0,l.useCallback)(async r=>{if(!d)throw j.Z.ConnectYourWallet;if(!e)throw j.Z.InvalidAccount;let o={id:r.address,alias:r.alias,channels:r.permissions.channels,messageTypes:r.permissions.messageTypes,revoked:!1},a=await d.getAddSteps(),l=a.map(e=>y.n[e]),c=d.addNewAccountPermissionSteps(o);try{let e;for(;!e;){let{value:r,done:o}=await c.next();if(o){e=r;break}await p(l)}}finally{await u()}},[d,e,p,u]),T=(0,l.useCallback)(async()=>{null==m||m.add({variant:"info",title:"Permission created",text:"Redirecting to permissions page..."}),await new Promise(e=>setTimeout(e,2e3)),await c(),r.push(P.cr.console.permissions.home)},[r,m,c]),S=(0,l.useMemo)(()=>({address:"",alias:"",permissions:{channels:[],messageTypes:[{type:b.Cs.post,postTypes:[],authorized:!1},{type:b.Cs.aggregate,aggregateKeys:[],authorized:!1},{type:b.Cs.instance,authorized:!1},{type:b.Cs.program,authorized:!1},{type:b.Cs.store,authorized:!1}]}}),[]),{control:Z,handleSubmit:k,formState:{errors:R,isDirty:B}}=(0,g.c)({defaultValues:S,onSubmit:f,onSuccess:T,resolver:(0,N.F)(_.x.addSchema),readyDeps:[]}),I=(0,x.qo)({control:Z}),z=(0,x.bc)({control:Z,name:"address"}),A=(0,x.bc)({control:Z,name:"alias"}),E=(0,l.useMemo)(()=>{if(!e)return function(e){let{title:r,description:o}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"tp-body3 fs-18 text-base2",children:r}),(0,a.jsx)("p",{className:"tp-body1 fs-14 text-base2",children:o})]})}({title:"Account connection required",description:"Please connect your account to ".concat("create a new permission",".\n                  Connect your wallet using the top-right button to access all features.")})},[e]),O=(0,l.useMemo)(()=>e?"Save permissions":"Connect",[e]),F=(0,l.useMemo)(()=>"Save permissions"!==O||!!E,[O,E]);return{createPermissionDisabled:F,createPermissionDisabledMessage:E,createPermissionButtonTitle:O,values:I,control:Z,errors:R,handleSubmit:k,handleBack:o,addressCtrl:z,aliasCtrl:A,isDirty:B}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(m(),{children:[(0,a.jsx)("title",{children:"Console | New Permission | Aleph Cloud"}),(0,a.jsx)("meta",{name:"description",content:"Delegate permissions to your resources in Aleph Cloud"})]}),(0,a.jsx)(Z.Z,{handleBack:W}),(0,a.jsxs)(T.Z,{onSubmit:U,errors:L,children:[d&&(0,a.jsx)(z,{children:(0,a.jsx)(f.F,{children:(0,a.jsx)(k.Z,{$color:"warning",children:d})})}),(0,a.jsx)(A,{children:(0,a.jsxs)(f.F,{children:[(0,a.jsx)(S.N,{number:1,children:"Recipient"}),(0,a.jsx)(E,{children:(0,a.jsx)(p.Jy,{children:(0,a.jsxs)(O,{className:"bg-light1",children:[(0,a.jsx)(p.oi,{...q.field,...q.fieldState,label:"Recipient account address",required:!0,placeholder:"Wallet address 0x..."}),(0,a.jsx)(p.oi,{...D.field,...D.fieldState,label:"Account alias",required:!0,placeholder:"Alias (for your reference)"})]})})})]})}),(0,a.jsx)(F,{children:(0,a.jsxs)(f.F,{children:[(0,a.jsx)(S.N,{number:2,children:"Permissions"}),(0,a.jsx)("p",{className:"tp-body1",children:"Select what this account may do and revoke access at any time."}),(0,a.jsx)(M,{children:(0,a.jsx)(B.Z,{control:u})})]})}),(0,a.jsx)(R.Z,{containerRef:r,shouldHide:!1,shouldRender:J,children:(0,a.jsx)(V,{children:(0,a.jsx)(I,{disabled:o,title:c,tooltipContent:d,isFooter:!0,handleSubmit:U})})})]})]})}I.displayName="CheckoutButton";var z=(0,d.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),A=(0,d.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),E=(0,d.ZP)("div")({position:"relative",marginBottom:"1.5rem",marginTop:"3rem",minHeight:"6rem",paddingLeft:"0px",paddingRight:"0px"}),O=(0,d.ZP)("div")({display:"flex",flexDirection:"column",rowGap:"1rem",padding:"1.5rem"}),F=(0,d.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),M=(0,d.ZP)("div")({marginTop:"1.5rem"}),V=(0,d.ZP)("div").withConfig({displayName:"cmp___StyledDiv4",componentId:"sc-1r36ivm-0"})({display:"flex",width:"100%",alignItems:"center",justifyContent:"flex-end",paddingLeft:"1.5rem",paddingRight:"1.5rem",paddingTop:"1rem",paddingBottom:"1rem"})},56312:function(e,r,o){"use strict";o.d(r,{F:function(){return t}});var a=o(87536);let s=(e,r,o)=>{if(e&&"reportValidity"in e){let d=(0,a.U2)(o,r);e.setCustomValidity(d&&d.message||""),e.reportValidity()}},resolvers_o=(e,r)=>{for(let o in r.fields){let a=r.fields[o];a&&a.ref&&"reportValidity"in a.ref?s(a.ref,o,e):a.refs&&a.refs.forEach(r=>s(r,o,e))}},resolvers_r=(e,r)=>{r.shouldUseNativeValidation&&resolvers_o(e,r);let o={};for(let d in e){let l=(0,a.U2)(r.fields,d),c=Object.assign(e[d]||{},{ref:l&&l.ref});if(i(r.names||Object.keys(e),d)){let e=Object.assign({},(0,a.U2)(o,d));(0,a.t8)(e,"root",c),(0,a.t8)(o,d,e)}else(0,a.t8)(o,d,c)}return o},i=(e,r)=>e.some(e=>e.startsWith(r+"."));var n=function(e,r){for(var o={};e.length;){var d=e[0],l=d.code,c=d.message,m=d.path.join(".");if(!o[m]){if("unionErrors"in d){var p=d.unionErrors[0].errors[0];o[m]={message:p.message,type:p.code}}else o[m]={message:c,type:l}}if("unionErrors"in d&&d.unionErrors.forEach(function(r){return r.errors.forEach(function(r){return e.push(r)})}),r){var u=o[m].types,f=u&&u[d.code];o[m]=(0,a.KN)(m,r,o,l,f?[].concat(f,d.message):d.message)}e.shift()}return o},t=function(e,r,o){return void 0===o&&(o={}),function(a,d,l){try{return Promise.resolve(function(d,c){try{var m=Promise.resolve(e["sync"===o.mode?"parse":"parseAsync"](a,r)).then(function(e){return l.shouldUseNativeValidation&&resolvers_o({},l),{errors:{},values:o.raw?a:e}})}catch(e){return c(e)}return m&&m.then?m.then(void 0,c):m}(0,function(e){if(Array.isArray(null==e?void 0:e.errors))return{values:{},errors:resolvers_r(n(e.errors,!l.shouldUseNativeValidation&&"all"===l.criteriaMode),l)};throw e}))}catch(e){return Promise.reject(e)}}}}},function(e){e.O(0,[7536,2243,9774,2888,179],function(){return e(e.s=15877)}),_N_E=e.O()}]);