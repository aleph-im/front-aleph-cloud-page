(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8409],{90036:function(e,i,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/console/permissions",function(){return s(44035)}])},44035:function(e,i,s){"use strict";s.r(i),s.d(i,{default:function(){return PermissionsDashboardPage}});var n=s(85893),t=s(57833),o=s(67294),l=s(9008),r=s.n(l),a=s(99983),d=s(75968),c=s(27107),m=s(18585),p=s(34517),h=s(67102),u=s(73899);let f=t.ZP.div.withConfig({displayName:"styles__StyledCopytoClipboard",componentId:"sc-1t6qmsy-0"})(["",""],e=>{let{theme:i}=e;return(0,t.iv)([""," &:hover ","{color:",";}"],{display:"flex",cursor:"pointer",alignItems:"center",columnGap:"0.5rem"},g,i.color.main0)}),g=(0,t.ZP)(u.JO).withConfig({displayName:"styles__StyledIcon",componentId:"sc-1t6qmsy-1"})(["",""],e=>{let{theme:i,$color:s}=e;return(0,t.iv)(["color:",";transition-property:color;transition-duration:","ms;transition-timing-function:",";"],i.color[s],i.transition.duration.fast,i.transition.timing)}),CopytoClipboard=e=>{let{text:i,textToCopy:s,iconColor:t="purple3"}=e,o=(0,u.vx)(s||"");return(0,n.jsxs)(f,{onClick:o,children:[i,(0,n.jsx)(g,{name:"copy",$color:t,size:"0.8em"})]})};CopytoClipboard.displayName="CopytoClipboard";var x=(0,o.memo)(CopytoClipboard),y=s(75650),v=s(87536),j=s(24959),w=s(16031);let PermissionsDetail=e=>{let{permissions:i,onSubmit:s,onUpdate:t,channelsPanelOrder:l=1}=e,{handleSubmit:r,errors:a,control:d}=function(e){let{permissions:i,onSubmitSuccess:s,onUpdate:n}=e,t={channels:i.channels,messageTypes:i.messageTypes,revoked:i.revoked},l=(0,o.useCallback)(async e=>{let n={id:i.id,alias:i.alias,...e};console.log("Updated permissions:",n),null==s||s(n)},[i.id,i.alias,s]),{control:r,handleSubmit:a,formState:{errors:d,isDirty:c}}=(0,j.c)({defaultValues:t,onSubmit:l,onSuccess:()=>Promise.resolve()}),m=(0,v.qo)({control:r});return(0,o.useEffect)(()=>{if(n){var e,s;let t={id:i.id,alias:i.alias,channels:null!==(e=m.channels)&&void 0!==e?e:i.channels,messageTypes:null!==(s=m.messageTypes)&&void 0!==s?s:i.messageTypes,revoked:i.revoked};n(t)}},[m,i.id,i.alias,i.channels,i.messageTypes,i.revoked,n]),{control:r,handleSubmit:a,errors:d,isDirty:c}}({permissions:i,onSubmitSuccess:s,onUpdate:t});return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(P,{id:"permissions-detail-form",onSubmit:r,errors:a,children:(0,n.jsxs)(b,{children:[(0,n.jsxs)(k,{children:[(0,n.jsx)("div",{className:"tp-info fs-14",children:"Recipient details"}),(0,n.jsx)(u.Jy,{children:(0,n.jsxs)(R,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(u._7,{id:"Object12",size:90,color:"main0"})}),(0,n.jsxs)(N,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"tp-info fs-10 text-main0",children:"Recipient account address"}),(0,n.jsx)("div",{children:(0,n.jsx)(x,{text:(0,n.jsx)("span",{className:"tp-body1 fs-12",children:i.id}),textToCopy:i.id})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"tp-info fs-10 text-main0",children:"Recipient alias"}),(0,n.jsx)("div",{className:"tp-body2",children:i.alias||"-"})]})]})]})})]}),(0,n.jsxs)(_,{children:[(0,n.jsx)("div",{className:"tp-info fs-14",children:"Permissions details"}),(0,n.jsx)(w.Z,{control:d,name:"",channelsPanelOrder:l})]})]})})})};PermissionsDetail.displayName="PermissionsDetail";var C=(0,o.memo)(PermissionsDetail),P=(0,t.ZP)(y.Z)({overflowY:"auto"}),b=(0,t.ZP)("div")({display:"flex",flexDirection:"column",rowGap:"3rem"}),k=(0,t.ZP)("div")({display:"flex",flexDirection:"column",rowGap:"0.5rem"}),R=(0,t.ZP)("div")({display:"flex",columnGap:"1rem"}),N=(0,t.ZP)("div")({display:"flex",flexDirection:"column",rowGap:"0.5rem"}),_=(0,t.ZP)("div").withConfig({displayName:"cmp___StyledDiv5",componentId:"sc-pnzfvs-0"})({display:"flex",flexDirection:"column",rowGap:"0.5rem"}),Z=s(58317),S=s(14685);let CountBadge=e=>{let{count:i}=e;return(0,n.jsx)(O,{className:"bg-purple4 fs-10 tp-info",children:i})};CountBadge.displayName="CountBadge";var T=(0,o.memo)(CountBadge),O=(0,t.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-1p7jh5f-0"})({display:"flex",minHeight:"1rem",width:"fit-content",minWidth:"1rem",alignItems:"center",borderRadius:"0.375rem",paddingLeft:"0.375rem",paddingRight:"0.375rem",paddingTop:"0.25rem",paddingBottom:"0.25rem"}),D=s(60566);let PermissionTypeItem=e=>{let{type:i,count:s}=e;return(0,n.jsxs)(A,{className:"tp-info fs-12",children:[i,void 0!==s&&s>0&&(0,n.jsx)(T,{count:s})]})};PermissionTypeItem.displayName="PermissionTypeItem";var I=(0,o.memo)(PermissionTypeItem),A=(0,t.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-1ggh9p7-0"})({display:"flex",alignItems:"center",columnGap:"0.25rem"});let PermissionsList=e=>{let{messageTypes:i}=e,s=i.filter(e=>e.authorized);return 0===s.length?(0,n.jsx)("div",{className:"tp-info fs-12",children:"None"}):(0,n.jsx)(B,{children:s.map((e,i)=>{let t;let l=i===s.length-1,r=e.type.toUpperCase();return e.type===D.Cs.post&&"postTypes"in e?t=e.postTypes.length||void 0:e.type===D.Cs.aggregate&&"aggregateKeys"in e&&(t=e.aggregateKeys.length||void 0),(0,n.jsxs)(o.Fragment,{children:[(0,n.jsx)(I,{type:r,count:t}),!l&&(0,n.jsx)(z,{className:"tp-info fs-12",children:","})]},e.type)})})};PermissionsList.displayName="PermissionsList";var L=(0,o.memo)(PermissionsList),B=(0,t.ZP)("div")({display:"flex",alignItems:"center",columnGap:"0.125rem"}),z=(0,t.ZP)("span").withConfig({displayName:"cmp___StyledSpan",componentId:"sc-1warxah-0"})({marginRight:"0.125rem"}),E=s(87402),G=s(17743);let PermissionsRowActions=e=>{let{isRevoked:i=!1,onConfigure:s,onRevoke:t,onRestore:l}=e,[r,a]=o.useState(!1),d=(0,o.useRef)(null),c=(0,o.useRef)(null),m=(0,u.iP)(0),p=(0,u.b)(0),{shouldMount:h,stage:f}=(0,u.Yz)(r,250),{myRef:g,atRef:x,position:y}=(0,u.gM)({my:"top-right",at:"bottom-right",myRef:d,atRef:c,deps:[m,p,h]});return(0,u.O8)(()=>{r&&a(!1)},[g,x]),(0,n.jsxs)("span",{onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(E.JP,{ref:c,onClick:()=>a(!r),children:i?(0,n.jsx)(u.JO,{name:"plus-circle"}):(0,n.jsx)(u.JO,{name:"ellipsis"})}),(0,n.jsx)(G.h,{children:r&&(0,n.jsx)(E.$D,{$isOpen:"enter"===f,$position:y,ref:g,children:(0,n.jsxs)(F,{children:[(0,n.jsx)(M,{disabled:i,onClick:()=>{a(!1),s()},children:"Configure"}),i?(0,n.jsx)(K,{onClick:()=>{a(!1),l()},children:"Restore"}):(0,n.jsx)(U,{onClick:()=>{a(!1),t()},children:"Revoke"})]})})})]})};PermissionsRowActions.displayName="PermissionsRowActions";var J=(0,o.memo)(PermissionsRowActions),F=(0,t.ZP)("div")({display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start"}),M=(0,t.ZP)(E.Kk)({width:"100%",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:"0.75rem",paddingBottom:"0.75rem",textAlign:"left"}),K=(0,t.ZP)(E.Kk)({width:"100%",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:"0.75rem",paddingBottom:"0.75rem",textAlign:"left"}),U=(0,t.ZP)(E.Kk).withConfig({displayName:"cmp___StyledActionButton3",componentId:"sc-1vm6lmv-0"})({width:"100%",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:"0.75rem",paddingBottom:"0.75rem",textAlign:"left"});let getPermissionsTableColumns=e=>{let{onRowConfigure:i,onRowRevoke:s,onRowRestore:t}=e;return[{label:"Address",sortable:!0,cellProps:e=>({css:e.revoked?{textDecorationLine:"line-through",opacity:"0.6"}:""}),render:e=>{let{id:i}=e;return(0,n.jsx)("span",{onClick:e=>e.stopPropagation(),children:(0,n.jsx)(x,{text:(0,n.jsx)("span",{className:"tp-body1 fs-14",children:(0,S.bs)(i,7,8)}),textToCopy:i})})}},{label:"Alias",sortable:!0,cellProps:e=>({css:e.revoked?{textDecorationLine:"line-through",opacity:"0.6"}:""}),render:e=>{let{alias:i}=e;return(0,n.jsx)("div",{className:"tp-info fs-12",children:i||"-"})}},{label:"Channels",cellProps:e=>({css:e.revoked?{textDecorationLine:"line-through",opacity:"0.6"}:""}),render:e=>{let{channels:i}=e;return i.length?(0,n.jsx)(T,{count:i.length}):(0,n.jsx)("div",{className:"tp-info fs-12",children:"All"})}},{label:"Permissions",cellProps:e=>({css:e.revoked?{textDecorationLine:"line-through",opacity:"0.6"}:""}),render:e=>{let{messageTypes:i}=e;return(0,n.jsx)(L,{messageTypes:i})}},{label:"",width:"100%",align:"right",render:e=>(0,n.jsx)(J,{isRevoked:e.revoked,onConfigure:()=>i(e),onRevoke:()=>s(e),onRestore:()=>t(e)}),cellProps:()=>({css:{paddingLeft:"0.75rem !important"}})}]};var $=s(9911);let q=(0,o.memo)(e=>{let{data:i,onPermissionChange:s}=e,[t,l]=(0,o.useState)({isOpen:!1,title:""}),[r,a]=(0,o.useState)(!1),[d,c]=(0,o.useState)(i),[m,f]=(0,o.useState)(null);(0,o.useEffect)(()=>{c(i)},[i]),(0,o.useEffect)(()=>{if(t.selectedRow&&t.isOpen){let e=d.find(e=>{var i;return e.id===(null===(i=t.selectedRow)||void 0===i?void 0:i.id)});e&&e!==t.selectedRow&&l(i=>({...i,selectedRow:e}))}},[d,t.selectedRow,t.isOpen]);let handleRowConfigure=e=>{let i=d.find(i=>i.id===e.id)||e;f(i),l({isOpen:!0,title:"Permissions",type:"configure",selectedRow:i})},handleRowClick=e=>{handleRowConfigure(e)},g=(0,o.useCallback)(e=>{c(i=>i.map(i=>i.id===e.id?e:i))},[]),x=(0,o.useCallback)(e=>{c(i=>i.map(i=>i.id===e.id?e:i)),null==s||s(e),f(null),l({isOpen:!1,title:""})},[s]),y=(0,o.useCallback)(()=>{m&&c(e=>e.map(e=>e.id===m.id?m:e)),f(null),l({isOpen:!1,title:""})},[m]),v=(0,o.useCallback)(()=>{if(l(e=>({...e,isOpen:!1})),m){let e=d.find(e=>e.id===m.id),i=JSON.stringify(e)!==JSON.stringify(m);i?a(!0):(f(null),l({isOpen:!1,title:""}))}},[m,d]),j=(0,o.useCallback)(()=>{m&&c(e=>e.map(e=>e.id===m.id?m:e)),f(null),l({isOpen:!1,title:""}),a(!1)},[m]),w=(0,o.useCallback)(()=>{a(!1),l(e=>({...e,isOpen:!0}))},[]),P=getPermissionsTableColumns({onRowConfigure:handleRowConfigure,onRowRevoke:e=>{let i={...e,revoked:!0};c(s=>s.map(s=>s.id===e.id?i:s)),null==s||s(i)},onRowRestore:e=>{let i={...e,revoked:!1};c(s=>s.map(s=>s.id===e.id?i:s)),null==s||s(i)}}),b=t.selectedRow?(0,n.jsxs)(W,{children:[(0,n.jsxs)(u.zx,{type:"submit",form:"permissions-detail-form",color:"main0",kind:"functional",variant:"warning",children:[(0,n.jsx)(u.JO,{name:"arrow-left"}),"Continue"]}),(0,n.jsx)(H,{type:"button",onClick:y,className:"tp-header fs-14",children:"Cancel"})]}):null;return(0,n.jsxs)(n.Fragment,{children:[d.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Y,{children:(0,n.jsx)(h.Z,{borderType:"none",rowNoise:!0,clickableRows:!0,rowKey:e=>{let{id:i}=e;return i},data:d,columns:P,rowProps:e=>({onClick:()=>{e.revoked||handleRowClick(e)}})})}),(0,n.jsx)(X,{children:(0,n.jsx)(p.Z,{variant:"primary",href:$.cr.console.permissions.new,children:"Create permissions"})})]}):(0,n.jsx)(Q,{children:(0,n.jsx)(p.Z,{variant:"primary",href:$.cr.console.permissions.new,children:"Create permissions"})}),(0,n.jsx)(Z.Z,{isOpen:t.isOpen,onClose:v,title:t.title,footer:b,children:"configure"===t.type?t.selectedRow&&(0,n.jsx)(C,{permissions:t.selectedRow,onSubmit:x,onUpdate:g,channelsPanelOrder:2}):(0,n.jsx)(n.Fragment,{children:"ERROR"})}),(0,n.jsx)(u.u_,{open:r,onClose:w,width:"34rem",header:(0,n.jsx)(u.DU,{type:"h6",children:"Unsaved Changes"}),content:(0,n.jsxs)(V,{children:[(0,n.jsx)("p",{className:"tp-body",children:"You've made updates to your permission settings."}),(0,n.jsx)("p",{className:"tp-body",children:"If you leave now, these changes won't be saved."})]}),footer:(0,n.jsxs)(ee,{children:[(0,n.jsx)(u.zx,{type:"button",variant:"secondary",size:"md",onClick:w,children:"Cancel"}),(0,n.jsx)(u.zx,{type:"button",variant:"primary",size:"md",onClick:j,children:"Discard Changes"})]})})]})});q.displayName="PermissionsTabContent";var W=(0,t.ZP)("div")({display:"flex",justifyContent:"flex-start",columnGap:"1rem"}),H=(0,t.ZP)("button")({fontWeight:"700",fontStyle:"normal"}),Y=(0,t.ZP)("div")({maxWidth:"100%",overflow:"auto"}),X=(0,t.ZP)("div")({marginTop:"5rem",textAlign:"center"}),Q=(0,t.ZP)("div")({marginTop:"2.5rem",textAlign:"center"}),V=(0,t.ZP)("div")({marginBottom:"2rem"}),ee=(0,t.ZP)("div").withConfig({displayName:"cmp___StyledDiv6",componentId:"sc-vb750q-0"})({display:"flex",width:"100%",justifyContent:"space-between"}),ei=s(78823),es=s(35464),en=s(86780);function PermissionsDashboardPage(e){let{mainRef:i}=e,{permissions:s,manager:t,refetchPermissions:l}=function(){let{entities:e=[],refetch:i}=(0,c.M)(),s=(0,d.o)();return{permissions:e,manager:s,refetchPermissions:i}}(),{noti:p,next:h,stop:f}=(0,en.A)({}),[g,x]=(0,o.useState)(new Map),[y,v]=(0,o.useState)([]);o.useEffect(()=>{s&&(v(s),x(new Map))},[s]);let j=(0,o.useCallback)(e=>{let i=y.find(i=>i.id===e.id);delete e.key,x(s=>{let n=new Map(s),t=JSON.stringify(e)!==JSON.stringify(i);return console.log("original",i),console.log("updated",e),console.log("hasRealChanges",t),t?n.set(e.id,e):n.delete(e.id),n})},[y]),w=(0,o.useCallback)(async()=>{let e;if(!t)return;let i=Array.from(g.values()),s=await t.getAddSteps(),n=s.map(e=>en.n[e]),o=t.updatePermissionsSteps(i);try{for(;!e;){let{value:i,done:s}=await o.next();if(s){e=i;break}await h(n)}x(new Map)}finally{await f(),e&&(null==p||p.add({variant:"info",title:"Permissions updated",text:"Refreshing permissions data..."}),await new Promise(e=>setTimeout(e,2e3)),await l())}},[t,g,h,f,p,l]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"Console | Permissions | Aleph Cloud"}),(0,n.jsx)("meta",{name:"description",content:"Manage who has permissions to your resources in Aleph Cloud"})]}),(0,n.jsxs)("div",{children:[!!(null==s?void 0:s.length)&&(0,n.jsx)(et,{$variant:"xl",children:(0,n.jsx)(q,{data:s,onPermissionChange:j})}),(0,n.jsx)(ei.Z,{imageSrc:"/img/dashboard/instance.svg",imageAlt:"Permissions illustration",info:"WHAT ARE...",title:"Permissions",description:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eo,{className:"tp-body2",children:"Ideal for teams, apps, or automated workloads."})," ","Empower teammates or connected wallets to spend your credits safely. Grant permission to use your credits, define what they can deploy, and revoke access whenever you need."]}),withButton:(null==s?void 0:s.length)===0,buttonUrl:$.cr.console.permissions.new,buttonText:"Create permissions"})]}),(0,n.jsx)(a.F,{$variant:"xl",children:(0,n.jsx)(m.Z,{})}),g.size&&(0,n.jsx)(es.Z,{containerRef:i,shouldHide:!1,children:(0,n.jsx)(el,{children:(0,n.jsx)(u.zx,{color:"main0",variant:"primary",onClick:w,children:"Save changes"})})})]})}var et=(0,t.ZP)(a.F)({marginTop:"2.5rem",marginBottom:"2.5rem"}),eo=(0,t.ZP)("div")({opacity:"0.85"}),el=(0,t.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-1rqtyyp-0"})({display:"flex",width:"100%",alignItems:"center",justifyContent:"flex-end",paddingLeft:"1.5rem",paddingRight:"1.5rem",paddingTop:"1rem",paddingBottom:"1rem"})}},function(e){e.O(0,[7536,3339,2243,9774,2888,179],function(){return e(e.s=90036)}),_N_E=e.O()}]);