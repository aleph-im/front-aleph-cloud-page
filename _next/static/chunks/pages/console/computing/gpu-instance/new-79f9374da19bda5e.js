(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8669],{79474:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/console/computing/gpu-instance/new",function(){return n(85052)}])},85052:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return NewGpuInstancePage}});var i=n(85893),o=n(57833),s=n(67294),r=n(9008),d=n.n(r),a=n(25675),l=n.n(a),m=n(31515),c=n(72882),p=n(53054),u=n(73461),h=n(34865),g=n(48998),y=n(20782),x=n(52464),f=n(34708),v=n(9911),j=n(16451),C=n(99983),b=n(75650),w=n(24607),P=n(21574),Z=n(39674),M=n(45866),T=n(49531),A=n(7053),k=n(40544),S=n(93788),B=n(85661),N=n(93161),R=n(9754),I=n(11163),_=n.n(I),G=n(80987),L=n(24959),z=n(18090),F=n(31776),D=n(87536),E=n(56312),U=n(37419),H=n(60539),O=n(68885),X=n(13450),Y=n(86780),q=n(9324),V=n(72648),K=n(50586),W=n(72077),J=n(19061);function tooltipContent(e){let{title:t,description:n}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"tp-body3 fs-18 text-base2",children:t}),(0,i.jsx)("p",{className:"tp-body1 fs-14 text-base2",children:n})]})}var Q=n(65426),$=n(29206),ee=n(78474),et=n(67100),en=n(41698),ei=n(28565),eo=n(48900);let es=s.memo(e=>{let{disabled:t,title:n="Create instance",tooltipContent:o,isFooter:r,shouldRequestTermsAndConditions:d,handleRequestTermsAndConditionsAgreement:a,handleSubmit:l}=e,m=(0,s.useRef)(null);return(0,i.jsx)(c.ZP,{ref:m,type:d?"button":"submit",color:"main0",kind:"default",size:"lg",variant:"primary",disabled:t,tooltipContent:o,tooltipPosition:{my:r?"bottom-right":"bottom-center",at:r?"top-right":"top-center"},onClick:d?a:l,children:n})});function NewGpuInstancePage(e){var t;let{mainRef:n}=e,{address:o,accountBalance:r,blockchainName:a,streamDisabled:eB,disabledStreamDisabledMessage:eN,createInstanceDisabled:eR,createInstanceDisabledMessage:eI,createInstanceButtonTitle:e_,values:eG,control:eL,errors:ez,cost:eF,node:eD,nodeSpecs:eE,selectedModal:eU,setSelectedModal:eH,selectedNode:eO,setSelectedNode:eX,termsAndConditions:eY,shouldRequestTermsAndConditions:eq,handleManuallySelectCRN:eV,handleSelectNode:eK,handleSubmit:eW,handleCloseModal:eJ,handleBack:eQ,handleRequestTermsAndConditionsAgreement:e$,handleAcceptTermsAndConditions:e0,handleCheckTermsAndConditions:e5}=function(){var e;let[,t]=(0,R.mr)(),{blockchain:n,account:o,balance:r=0,handleConnect:d}=(0,V.R)({triggerOnMount:!1}),a=(0,I.useRouter)(),{crn:l,gpu:m}=a.query,c=(0,s.useRef)(void 0),[p,u]=(0,s.useState)(),[h,g]=(0,s.useState)(),{specs:y}=(0,H.O)(),x=(0,s.useMemo)(()=>{if(y){if(!l||!m||"string"!=typeof l||"string"!=typeof m)return c.current;if(p)c.current=p;else{var e,t,n,i;let o=null===(n=y[l])||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:null===(e=t.compatible_available_gpus)||void 0===e?void 0:e.find(e=>e.model===m);if(o&&(null===(i=y[l])||void 0===i?void 0:i.data)){let e={...y[l].data};c.current={...e,selectedGpu:o}}}return c.current}},[l,m,p,y]),f=(0,s.useMemo)(()=>{var e;if(x&&y)return null===(e=y[x.hash])||void 0===e?void 0:e.data},[y,x]),{termsAndConditions:j}=(0,Q.Z)({termsAndConditionsMessageHash:null==x?void 0:x.terms_and_conditions}),{defaultTiers:C}=(0,$.g)({type:v.py.GpuInstance,gpuModel:null==p?void 0:null===(e=p.selectedGpu)||void 0===e?void 0:e.model}),b=(0,ee.c)(),{next:w,stop:P}=(0,Y.A)({}),Z=(0,s.useCallback)(async e=>{if(!b)throw K.Z.ConnectYourWallet;if(!o)throw K.Z.InvalidAccount;if(!x||!x.stream_reward)throw K.Z.InvalidNode;if(!f)throw K.Z.InvalidCRNSpecs;if(!(null==e?void 0:e.streamCost))throw K.Z.InvalidStreamCost;let[i]=C,s=O.B.validateMinNodeSpecs(i,f);if(!s)throw K.Z.InvalidCRNSpecs;if(!n||!(0,G.SH)(n)||!(0,G.bz)(o))throw d({blockchain:W.Ek.BASE}),K.Z.InvalidNetwork;let r=await (0,G.OH)(o),a={chain:n,type:v.XL.Stream,sender:o.address,receiver:x.stream_reward,streamCost:e.streamCost,streamDuration:e.streamDuration},l={...e,payment:a,node:e.paymentMethod===v.XL.Stream?x:void 0},m=await b.getAddSteps(l),c=m.map(e=>Y.n[e]),p=b.addSteps(l,r);try{let e;for(;!e;){let{value:t,done:n}=await p.next();if(n){e=t;break}await w(c)}t(new q.Wy({name:"instance",entities:e})),await _().replace(v.cr.console.computing.gpus.detail(e.id))}finally{await P()}},[b,o,x,f,C,n,d,t,w,P]),M=(0,s.useMemo)(()=>{var e;return{...z.y,image:F.iJ,specs:void 0,systemVolume:{size:null===(e=C[0])||void 0===e?void 0:e.storage},paymentMethod:v.XL.Stream,streamDuration:X.xe,streamCost:Number.POSITIVE_INFINITY,termsAndConditions:void 0}},[C]),{control:T,handleSubmit:A,formState:{errors:k},setValue:S}=(0,L.c)({defaultValues:M,onSubmit:Z,resolver:(0,E.F)(et.Q.addStreamSchema),readyDeps:[M]}),B=(0,D.qo)({control:T}),{storage:N}=B.specs||{},{size:es}=B.systemVolume,er=(0,s.useMemo)(()=>({chain:n,type:v.XL.Stream,sender:null==o?void 0:o.address,receiver:null==x?void 0:x.stream_reward,streamCost:(null==B?void 0:B.streamCost)||1,streamDuration:null==B?void 0:B.streamDuration}),[B,n,o,x]),ed=(0,s.useMemo)(()=>({entityType:v.py.GpuInstance,props:{node:x,specs:B.specs,volumes:B.volumes,domains:B.domains,streamDuration:B.streamDuration,paymentMethod:B.paymentMethod,payment:er,isPersistent:!0,image:B.image,systemVolume:B.systemVolume,name:B.name||"MOCK",sshKeys:B.sshKeys||[{key:"MOCK",isNew:!0,isSelected:!0}]}}),[x,er,B]),ea=(0,U.F)(ed),el=(0,s.useMemo)(()=>!!(null==x?void 0:x.terms_and_conditions)&&B.paymentMethod===v.XL.Stream,[x,B.paymentMethod]),em=(0,s.useMemo)(()=>{var e;return n?null===(e=W.DR[n])||void 0===e?void 0:e.name:"Current network"},[n]),ec=tooltipContent({title:"Holder Tier not supported",description:"GPU Instances only support Pay-as-you-go."}),ep=(0,s.useMemo)(()=>(null==o?void 0:o.address)||"",[o]),{canAfford:eu,isCreateButtonDisabled:eh}=(0,ei.U)({cost:ea,accountBalance:r}),eg=(0,s.useMemo)(()=>!!o&&(!eh||eu),[o,eu,eh]),ey=(0,s.useMemo)(()=>B.paymentMethod!==v.XL.Stream||(0,G.SH)(n)?B.paymentMethod!==v.XL.Hold||(0,J.e)(n)?void 0:tooltipContent({title:"Payment Method not supported",description:(0,i.jsxs)(i.Fragment,{children:[em," doesn't support Holder tier payment method. Please switch the chain using the dropdown at the top of the page."]})}):tooltipContent({title:"Selected chain not supported",description:(0,i.jsxs)(i.Fragment,{children:[em," supports only the Holder tier payment method. To use the Pay-As-You-Go tier, please switch to the ",(0,i.jsx)("strong",{children:"Base"})," or"," ",(0,i.jsx)("strong",{children:"Avalanche"})," chain using the dropdown at the top of the page."]})}),[n,em,B.paymentMethod]),ex=(0,s.useMemo)(()=>o?eg?"Create instance":"Insufficient ALEPH":"Connect",[o,eg]),ef=(0,s.useMemo)(()=>"Create instance"!==ex||!!ey,[ex,ey]),ev=(0,s.useCallback)(async()=>{var e,t;if(g(void 0),!p)return;let{crn:n,gpu:i,...o}=a.query;(n!==p.hash||i!==(null===(e=p.selectedGpu)||void 0===e?void 0:e.model))&&_().replace({query:p?{...o,crn:p.hash,gpu:null===(t=p.selectedGpu)||void 0===t?void 0:t.model}:o})},[a.query,p]),ej=(0,s.useCallback)(()=>{g("node-list")},[]),eC=(0,s.useCallback)(()=>{g(void 0)},[]),eb=(0,s.useCallback)(()=>{g("terms-and-conditions")},[]),ew=(0,s.useCallback)(()=>{B.termsAndConditions?S("termsAndConditions",void 0):S("termsAndConditions",null==x?void 0:x.terms_and_conditions)},[B.termsAndConditions,x,S]),eP=(0,s.useCallback)(e=>{eC(),A(e)},[eC,A]),eZ=(0,en.Z)(N);return(0,s.useEffect)(()=>{if(!N||N===eZ)return;let e=es===eZ?N:Math.max(N,es);S("systemVolume.size",e)},[N,eZ,S,es]),(0,s.useEffect)(()=>{S("nodeSpecs",f)},[f,S]),(0,s.useEffect)(()=>{ea&&B.streamCost!==ea.cost&&S("streamCost",ea.cost)},[ea,S,B]),(0,eo.s)({formPaymentMethod:B.paymentMethod,setValue:S}),{address:ep,accountBalance:r,blockchainName:em,createInstanceDisabled:ef,createInstanceDisabledMessage:ey,createInstanceButtonTitle:ex,values:B,control:T,errors:k,cost:ea,node:x,nodeSpecs:f,streamDisabled:!0,disabledStreamDisabledMessage:ec,selectedModal:h,setSelectedModal:g,selectedNode:p,setSelectedNode:u,termsAndConditions:j,shouldRequestTermsAndConditions:el,handleManuallySelectCRN:ej,handleSelectNode:ev,handleSubmit:A,handleCloseModal:eC,handleBack:()=>{a.push(".")},handleRequestTermsAndConditionsAgreement:eb,handleCheckTermsAndConditions:ew,handleAcceptTermsAndConditions:eP}}(),{apiServer:e1}=(0,j.r)(),e8=(0,s.useCallback)(e=>(eG.paymentMethod===v.XL.Stream?1:0)+e,[eG.paymentMethod]),e2=(0,s.useMemo)(()=>[{label:"NAME",render:e=>(0,i.jsx)(m.tJ,{hash:e.hash,name:e.name,picture:e.picture,ImageCmp:l(),apiServer:e1})},{label:"SCORE",render:e=>(0,i.jsx)(m.WG,{score:e.score})},{label:"GPU",render:e=>{var t;return null==e?void 0:null===(t=e.selectedGpu)||void 0===t?void 0:t.model}},{label:"",align:"right",render:()=>(0,i.jsx)(er,{children:(0,i.jsx)(m.zx,{type:"button",kind:"functional",size:"md",variant:"warning",onClick:()=>eH("node-list"),children:"Change GPU"})})}],[e1,eH]),e4=(0,s.useMemo)(()=>eD?[eD]:[],[eD]),e7=(0,s.useRef)(null);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(d(),{children:[(0,i.jsx)("title",{children:"Console | New GPU Instance | Aleph Cloud"}),(0,i.jsx)("meta",{name:"description",content:"Create a new GPU-enabled virtual machine on Aleph Cloud"})]}),(0,i.jsx)(S.Z,{handleBack:eQ}),(0,i.jsxs)(b.Z,{onSubmit:eW,errors:ez,children:[(0,i.jsx)(ed,{children:(0,i.jsx)(C.F,{children:(0,i.jsx)(P.Z,{selected:"gpu-instance"})})}),eI&&(0,i.jsx)(ea,{children:(0,i.jsx)(C.F,{children:(0,i.jsx)(B.Z,{$color:"warning",children:eI})})}),(0,i.jsx)(el,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:1,children:"Selected GPU"}),(0,i.jsxs)("p",{children:["Your instance is configured with your manually selected GPU, operating under the ",(0,i.jsx)(A.Z,{children:"Pay-as-you-go"})," payment method on ",(0,i.jsx)(A.Z,{children:a}),". This setup provides direct control over your resource allocation and costs, requiring active management of your instance. To adjust your GPU or explore different payment options, modify your selection below."]}),(0,i.jsx)(em,{children:(0,i.jsxs)(m.Jy,{children:[(0,i.jsx)(Z.Z,{columns:e2,data:e4,rowProps:()=>({className:"_active"})}),(0,i.jsx)(ec,{children:!eD&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(c.ZP,{ref:e7,type:"button",kind:"functional",variant:"warning",size:"md",onClick:eV,children:"Manually select GPU"})})})]})})]})}),(0,i.jsx)(ep,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:e8(1),children:"Select your tier"}),eG.paymentMethod===v.XL.Hold?(0,i.jsxs)("p",{children:["Your instance is ready to be configured using our"," ",(0,i.jsx)(A.Z,{children:"automated CRN selection"}),", set to run on"," ",(0,i.jsx)(A.Z,{children:a})," with the"," ",(0,i.jsx)(A.Z,{children:"Holder-tier payment"})," method, allowing you seamless access while you hold ALEPH tokens. If you wish to customize your Compute Resource Node (CRN) or use a different payment approach, you can change your selection below."]}):(0,i.jsx)("p",{children:"Please select one of the available instance tiers as a base for your VM. You will be able to customize the volumes further below in the form."}),(0,i.jsxs)(eu,{children:[(0,i.jsx)(M.Z,{show:!!eD&&!eE}),(0,i.jsx)(u.Z,{name:"specs",control:eL,type:v.py.GpuInstance,gpuModel:null==eD?void 0:null===(t=eD.selectedGpu)||void 0===t?void 0:t.model,isPersistent:!0,paymentMethod:eG.paymentMethod,nodeSpecs:eE,children:!eD&&(0,i.jsx)(eh,{children:"First select your node in the previous step"})})]})]})}),(0,i.jsx)(eg,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:e8(2),children:"Choose an image"}),(0,i.jsx)("p",{children:"Chose a base image for your GPU Instance. It's the base system that you will be able to customize."}),(0,i.jsx)(ey,{children:(0,i.jsx)(p.Z,{name:"image",control:eL})})]})}),(0,i.jsx)(ex,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:e8(3),children:"Configure SSH Key"}),(0,i.jsx)("p",{children:"Access your cloud instances securely. Give existing key's below access to this instance or add new keys. Remember, storing private keys safely is crucial for security. If you need help, our support team is always ready to assist."}),(0,i.jsx)(ef,{children:(0,i.jsx)(g.Z,{name:"sshKeys",control:eL})})]})}),(0,i.jsx)(ev,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:e8(4),children:"Name and tags"}),(0,i.jsx)(ej,{children:"Organize and identify your instances more effectively by assigning a unique name, obtaining a hash reference, and defining multiple tags. This helps streamline your development process and makes it easier to manage your web3 instances."}),(0,i.jsx)(x.Z,{control:eL,entityType:v.py.Instance})]})}),(0,i.jsx)(eC,{children:(0,i.jsxs)(C.F,{children:[(0,i.jsx)(T.N,{number:e8(5),children:"Advanced Configuration Options"}),(0,i.jsx)(eb,{children:"Customize your GPU Instance with our Advanced Configuration Options. Add volumes and custom domains to meet your specific needs."}),(0,i.jsxs)(ew,{children:[(0,i.jsx)(eP,{children:(0,i.jsxs)(w.Z,{label:"Add Volume",children:[(0,i.jsx)(m.DU,{forwardedAs:"h2",type:"h6",color:"main0",children:"Add volumes"}),(0,i.jsx)(h.Z,{name:"volumes",control:eL,systemVolume:eG.systemVolume})]})}),(0,i.jsx)(eZ,{children:(0,i.jsxs)(w.Z,{label:"Add Custom Domain",children:[(0,i.jsx)(m.DU,{forwardedAs:"h2",type:"h6",color:"main0",children:"Custom domain"}),(0,i.jsx)(eM,{children:"You have the ability to configure a domain name to access your cloud instances. By setting up a user-friendly custom domain, accessing your instances becomes easier and more intuitive. It&s another way we&re making web3 cloud management as straightforward as possible."}),(0,i.jsx)(y.Z,{name:"domains",control:eL,entityType:v.sY.Instance})]})})]})]})}),(0,i.jsx)(f.Z,{control:eL,address:o,cost:eF,receiverAddress:null==eD?void 0:eD.reward,unlockedAmount:r,paymentMethod:eG.paymentMethod,streamDuration:eG.streamDuration,disablePaymentMethod:eB,disabledStreamTooltip:eN,mainRef:n,description:(0,i.jsx)(i.Fragment,{children:"You can either leverage the traditional method of holding tokens in your wallet for resource access, or opt for the Pay-As-You-Go (PAYG) system, which allows you to pay precisely for what you use, for the duration you need. The PAYG option includes a token stream feature, enabling real-time payment for resources as you use them."}),button:(0,i.jsx)(es,{disabled:eR,title:e_,tooltipContent:eI,isFooter:!1,shouldRequestTermsAndConditions:eq,handleRequestTermsAndConditionsAgreement:e$,handleSubmit:eW}),footerButton:(0,i.jsx)(es,{disabled:eR,title:e_,tooltipContent:eI,isFooter:!0,shouldRequestTermsAndConditions:eq,handleRequestTermsAndConditionsAgreement:e$,handleSubmit:eW})})]}),(0,i.jsx)(m.u_,{open:"node-list"===eU,onClose:eJ,width:"80rem",header:"",content:(0,i.jsx)(k.Z,{enableGpu:!0,selected:eO,onSelectedChange:eX}),footer:(0,i.jsx)(eT,{children:(0,i.jsx)(eA,{type:"button",variant:"primary",size:"md",onClick:eK,disabled:!eO,children:"Continue"})})}),(0,i.jsx)(m.u_,{open:"terms-and-conditions"===eU&&!!eY,onClose:eJ,width:"34rem",header:(0,i.jsx)(m.DU,{type:"h6",children:"Accept Terms & Conditions"}),content:eY&&(0,i.jsxs)(ek,{children:[(0,i.jsx)(m.XZ,{onChange:e5,checked:eG.termsAndConditions}),(0,i.jsxs)("div",{className:"tp-body",children:["I have read, understood, and agree to the"," ",(0,i.jsx)(N.Z,{text:"Terms & Conditions",href:eY.url,color:"main0",typo:"body3",underline:!0})," ","of this Core Resouce Node."]})]}),footer:(0,i.jsxs)(eS,{children:[(0,i.jsx)(m.zx,{type:"button",variant:"secondary",size:"md",onClick:eJ,children:"Cancel"}),(0,i.jsx)(m.zx,{type:"submit",variant:"primary",size:"md",onClick:e0,disabled:!eG.termsAndConditions,children:"Confirm & Proceed"})]})})]})}es.displayName="CheckoutButton";var er=(0,o.ZP)("div")({display:"flex",justifyContent:"flex-end",gap:"0.75rem"}),ed=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingTop:"0px",paddingBottom:"0px","@media (min-width: 48rem)":{paddingTop:"2rem",paddingBottom:"2rem"}}),ea=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),el=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),em=(0,o.ZP)("div")({position:"relative",marginBottom:"1.5rem",marginTop:"3rem",minHeight:"6rem",paddingLeft:"0px",paddingRight:"0px"}),ec=(0,o.ZP)("div")({marginTop:"1.5rem"}),ep=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),eu=(0,o.ZP)("div")({position:"relative",marginTop:"1.5rem",marginBottom:"1.5rem",paddingLeft:"0px",paddingRight:"0px"}),eh=(0,o.ZP)("div")({marginTop:"1.5rem",textAlign:"center"}),eg=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),ey=(0,o.ZP)("div")({marginBottom:"1.5rem",marginTop:"3rem",paddingLeft:"0px",paddingRight:"0px"}),ex=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),ef=(0,o.ZP)("div")({marginTop:"1.5rem",marginBottom:"1.5rem",paddingLeft:"0px",paddingRight:"0px"}),ev=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),ej=(0,o.ZP)("p")({marginBottom:"1.5rem"}),eC=(0,o.ZP)("section")({paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1.5rem",paddingTop:"5rem","@media (min-width: 48rem)":{paddingTop:"2.5rem",paddingBottom:"2.5rem"}}),eb=(0,o.ZP)("p")({marginBottom:"1.5rem"}),ew=(0,o.ZP)("div")({marginTop:"1.5rem",marginBottom:"1.5rem",paddingLeft:"0px",paddingRight:"0px"}),eP=(0,o.ZP)("div")({marginBottom:"1rem"}),eZ=(0,o.ZP)("div")({marginBottom:"1rem"}),eM=(0,o.ZP)("p")({marginBottom:"1.5rem"}),eT=(0,o.ZP)("div")({display:"flex",width:"100%",justifyContent:"flex-end"}),eA=(0,o.ZP)(m.zx)({marginLeft:"auto !important"}),ek=(0,o.ZP)("div")({marginBottom:"2rem",display:"flex",maxWidth:"28rem",alignItems:"center",gap:"1rem"}),eS=(0,o.ZP)("div").withConfig({displayName:"cmp___StyledDiv11",componentId:"sc-2i277u-0"})({display:"flex",width:"100%",justifyContent:"space-between"})}},function(e){e.O(0,[7536,1093,5675,4757,3268,6903,807,9774,2888,179],function(){return e(e.s=79474)}),_N_E=e.O()}]);