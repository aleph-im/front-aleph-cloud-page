(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7712],{76022:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/console/computing/instance/[hash]",function(){return t(67602)}])},96370:function(e,n,t){"use strict";t.d(n,{u:function(){return useRequestInstances}});var s=t(99978),i=t(77205);function useRequestInstances(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,s.U)();return(0,i.F)({...e,manager:n,name:"instance"})}},67602:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ManageInstance}});var s=t(85893),i=t(19521),l=t(9008),o=t.n(l),a=t(79632),d=t(11163),u=t(67294),c=t(99978),r=t(96370),m=t(57125),p=t(36286),h=t(49107),y=t(37850),v=t(50090),g=t(63831),f=t(68091),x=t(62394),j=t(32424),C=t(27917),S=t(69429),b=t(91986),k=t(18995),w=t(85786),_=t(40256),Z=t(73635),D=t(45806),I=t(21204),M=t(1131),O=t(9911),E=t(30425),K=t(25491),N=t(24541),R=t(14215),T=t(78436),V=t(95029);function ManageInstance(){var e,n;let{instance:t,manager:i,name:l,status:G,calculatedStatus:z,isAllocated:A,nodeDetails:L,immutableVolumes:P,persistentVolumes:B,mappedKeys:F,customDomains:X,handleCustomDomainClick:U,paymentData:J,logs:W,handleDownloadLogs:Q,isDownloadingLogs:Y,stopDisabled:$,handleStop:ee,startDisabled:en,handleStart:et,rebootDisabled:es,handleReboot:ei,deleteDisabled:el,handleDelete:eo,sidePanel:ea,handleImmutableVolumeClick:ed,handleSSHKeyClick:eu,closeSidePanel:ec,setTabId:er,sliderActiveIndex:em,handleBack:ep}=function(){let e=(0,d.useRouter)(),{hash:n}=e.query,{entities:t}=(0,r.u)({ids:n}),[s]=t||[],i=(0,c.U)(),[l,o]=(0,u.useState)("detail"),a="log"===l,x=(0,m.y)({executable:s,manager:i,subscribeLogs:a}),{streamDetails:j,logs:C}=x,S=(0,u.useMemo)(()=>{var e;return s?(null==s?void 0:null===(e=s.metadata)||void 0===e?void 0:e.name)||(0,h.zN)(s.id):""},[s]),b=(0,u.useMemo)(()=>(null==s?void 0:s.time)?Math.floor(Date.now()-1e3*s.time)/1e3:void 0,[null==s?void 0:s.time]),{handleDownloadLogs:k,isDownloadingLogs:w}=(0,y.Z)({fileName:S,logs:C}),_=(0,u.useCallback)(()=>{e.push(".")},[e]),{entities:Z}=(0,f.X)(),D=(0,u.useMemo)(()=>(null==s?void 0:s.authorized_keys)&&Z?s.authorized_keys.map(e=>Z.find(n=>n.key===e)):[],[s,Z]),{persistentVolumes:I,immutableVolumes:M}=(0,v.Z)({volumes:null==s?void 0:s.volumes}),{customDomains:O}=(0,g.Z)({entityId:null==s?void 0:s.id}),E=(0,u.useCallback)(e=>{q({isOpen:!0,type:"domain",selectedDomain:e})},[]),[K,N]=(0,u.useState)(),[R,T]=(0,u.useState)(!1);(0,u.useEffect)(()=>{let fetchCost=async()=>{if((null==s?void 0:s.payment)&&i){T(!0);try{let e=await i.getTotalCostByHash(s.payment.type,s.id);N(e)}catch(e){console.error("Error fetching cost:",e)}finally{T(!1)}}};fetchCost()},[s,i]);let V=(0,u.useMemo)(()=>{var e,n;switch(null==s?void 0:null===(e=s.payment)||void 0===e?void 0:e.type){case p.uG.hold:return[{cost:K,paymentType:p.uG.hold,runningTime:b,startTime:s.time,blockchain:s.payment.chain,loading:R}];case p.uG.superfluid:if(null==j?void 0:null===(n=j.streams)||void 0===n?void 0:n.length)return j.streams.map(e=>{var n;return{cost:e.flow,paymentType:p.uG.superfluid,runningTime:b,startTime:null==s?void 0:s.time,blockchain:null==s?void 0:null===(n=s.payment)||void 0===n?void 0:n.chain,loading:!1,receiver:e.receiver}});default:return[{paymentType:p.uG.hold,loading:!0}]}},[K,null==s?void 0:s.payment,b,null==s?void 0:s.time,null==j?void 0:j.streams,R]),[H,q]=(0,u.useState)({isOpen:!1}),G=(0,u.useCallback)(e=>{q({isOpen:!0,type:"volume",selectedVolume:e})},[]),z=(0,u.useCallback)(e=>{q({isOpen:!0,type:"sshKey",selectedSSHKey:e})},[]),A=(0,u.useCallback)(()=>{q(e=>({...e,isOpen:!1}))},[]),L=(0,u.useMemo)(()=>"log"===l?1:0,[l]);return{...x,instance:s,manager:i,mappedKeys:D,customDomains:O,handleCustomDomainClick:E,setTabId:o,handleBack:_,handleDownloadLogs:k,isDownloadingLogs:w,paymentData:V,immutableVolumes:M,persistentVolumes:I,name:S,sliderActiveIndex:L,sidePanel:H,handleImmutableVolumeClick:G,handleSSHKeyClick:z,closeSidePanel:A}}();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o(),{children:[(0,s.jsx)("title",{children:"Console | Manage Instance | Aleph Cloud"}),(0,s.jsx)("meta",{name:"description",content:"Manage your compute instance on Aleph Cloud"})]}),(0,s.jsx)(E.Z,{entity:t,name:l,type:O.py.Instance,isAllocated:A,status:G,calculatedStatus:z,showStart:!0,startDisabled:en,onStart:et,showDelete:!0,deleteDisabled:el,onDelete:eo,showStop:!0,stopDisabled:$,onStop:ee,showReboot:!0,rebootDisabled:es,onReboot:ei,onBack:ep}),(0,s.jsxs)(S.i,{activeIndex:em,children:[(0,s.jsx)(S.M,{children:(0,s.jsx)(K.Z,{leftColumnElements:[(0,s.jsx)(k.Z,{instance:t},"instance-details"),(0,s.jsx)(w.V,{onViewLogs:()=>er("log"),onDownloadLogs:Q,downloadingLogs:Y,disabled:!t||!A},"instance-logs-control"),(0,s.jsx)(M.Z,{sshKeys:F,onSSHKeyClick:eu},"instance-ssh-keys"),(0,s.jsx)(b.Z,{payments:J},"instance-payment")],rightColumnElements:[(0,s.jsx)(I.Z,{nodeDetails:L,termsAndConditionsHash:null==t?void 0:null===(n=t.requirements)||void 0===n?void 0:null===(e=n.node)||void 0===e?void 0:e.terms_and_conditions},"instance-hosting-crn"),(0,s.jsx)(D.Z,{executableStatus:G},"instance-connection-methods"),P.length&&(0,s.jsx)(Z.Z,{linkedVolumes:P,onImmutableVolumeClick:ed},"instance-linked-volumes"),B.length&&(0,s.jsx)(_.Z,{persistentVolumes:B},"instance-persistent-storage"),X.length&&(0,s.jsx)(N.Z,{customDomains:X,onCustomDomainClick:U},"instance-custom-domains"),(0,s.jsx)(T.Z,{entityHash:null==t?void 0:t.id,executableStatus:G,executableManager:i},"port-forwarding")]})}),(0,s.jsx)(S.M,{children:(0,s.jsxs)(H,{children:[(0,s.jsx)(V.Z,{onClick:()=>er("detail"),children:(0,s.jsx)(a.JO,{name:"angle-left",size:"1.3em"})}),(0,s.jsx)(q,{children:(0,s.jsx)(w.W,{logs:W})})]})})]}),(0,s.jsx)(x.h,{title:"volume"===ea.type?"Volume":"sshKey"===ea.type?"SSH Key":"Custom Domain",isOpen:ea.isOpen,onClose:ec,children:"volume"===ea.type?ea.selectedVolume&&(0,s.jsx)(C.Z,{volumeId:ea.selectedVolume.id}):"sshKey"===ea.type?ea.selectedSSHKey&&(0,s.jsx)(j.Z,{sshKeyId:ea.selectedSSHKey.id}):"domain"===ea.type?ea.selectedDomain&&(0,s.jsx)(R.Z,{domainId:ea.selectedDomain.id}):(0,s.jsx)(s.Fragment,{children:"ERROR"})})]})}var H=(0,i.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-1gq5pee-0"})({display:"flex",width:"100%",gap:"2rem",paddingLeft:"3rem",paddingRight:"3rem",paddingTop:"1.5rem",paddingBottom:"1.5rem"}),q=(0,i.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-1gq5pee-1"})({display:"flex",width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"0.75rem"})}},function(e){e.O(0,[7536,1505,8684,4215,4473,5859,9774,2888,179],function(){return e(e.s=76022)}),_N_E=e.O()}]);